<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra-BLE Seri Reklam Ä°stasyonu</title>
    <script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
    <style>
        :root { --p: #2563eb; --s: #059669; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: white; width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; margin-bottom: 10px; }
        .btn-qr { background: #1e293b; }
        .btn-auto { background: var(--p); }
        .btn-stop { background: #dc2626; display: none; }
        #status { display: none; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; margin-bottom: 10px; }
        
        /* YazdÄ±rma AlanÄ± */
        #printArea { display: none; flex-direction: column; gap: 50px; padding: 20px; }
        .qr-item { border: 2px solid #000; padding: 30px; border-radius: 20px; text-align: center; width: 350px; background: white; }
        
        @media print {
            .no-print { display: none !important; }
            #printArea { display: flex !important; }
            body { background: white; }
        }
    </style>
</head>
<body>

    <div class="admin-panel no-print">
        <h2 style="text-align:center;">ðŸ“¡ Otomatik BLE Reklam</h2>
        <div class="input-group">
            <label>Kampanya Metni</label>
            <input type="text" id="tInp" value="Ã–ZEL Ä°NDÄ°RÄ°M GÃœNÃœ!">
            <textarea id="mInp" rows="2">Bu QR kodu okutanlara anÄ±nda sÃ¼rpriz hediye!</textarea>
            <input type="text" id="urlInp" placeholder="Web Siteniz (Opsiyonel)">
        </div>

        <button class="btn btn-qr" onclick="createQR()">1. QR OLUÅžTUR & Ã–NÄ°ZLE</button>
        <button id="startBtn" class="btn btn-auto" onclick="startAutoMode()">2. OTOMATÄ°K SERÄ° YAYIN BAÅžLAT</button>
        <button id="stopBtn" class="btn btn-stop" onclick="stopAutoMode()">YAYINI DURDUR</button>
        <button class="btn btn-qr" style="background:#475569;" onclick="window.print()">3. A4 YAZDIR (2 ADET)</button>
        
        <div id="status"></div>
    </div>

    <div id="printArea">
        <div class="qr-item">
            <h1 class="q-title"></h1>
            <p class="q-msg"></p>
            <div id="q1" style="display:inline-block;"></div>
        </div>
        <div class="qr-item">
            <h1 class="q-title"></h1>
            <p class="q-msg"></p>
            <div id="q2" style="display:inline-block;"></div>
        </div>
    </div>

<script>
    let isAuto = false;

    function createQR() {
        try {
            const title = document.getElementById('tInp').value;
            const msg = document.getElementById('mInp').value;
            const web = document.getElementById('urlInp').value || window.location.href;
            const fullText = `REKLAM: ${title}\nMESAJ: ${msg}\nDOÄžRULAMA: ${web}`;

            document.querySelectorAll('.q-title').forEach(el => el.innerText = title);
            document.querySelectorAll('.q-msg').forEach(el => el.innerText = msg);

            // QR oluÅŸturma (KÃ¼tÃ¼phanenin yÃ¼klendiÄŸinden emin oluyoruz)
            if (typeof QRCode === "undefined") {
                alert("Hata: QR kÃ¼tÃ¼phanesi yÃ¼klenemedi. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edip sayfayÄ± yenileyin.");
                return;
            }

            ["q1", "q2"].forEach(id => {
                const el = document.getElementById(id);
                el.innerHTML = "";
                new QRCode(el, { text: fullText, width: 250, height: 250 });
            });

            document.getElementById('printArea').style.display = "flex";
            alert("QR Kodlar HazÄ±r! Åžimdi yazdÄ±rabilir veya yayÄ±nÄ± baÅŸlatabilirsiniz.");
        } catch (e) {
            alert("QR HatasÄ±: " + e.message);
        }
    }

    async function startAutoMode() {
        isAuto = true;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'block';
        loop();
    }

    function stopAutoMode() {
        isAuto = false;
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('status').style.display = 'none';
    }

    async function loop() {
        if (!isAuto) return;
        const s = document.getElementById('status');
        s.style.display = "block";
        s.style.background = "#2563eb";
        s.style.color = "white";
        s.innerText = "Yeni Cihaz TaranÄ±yor... (Listeden SeÃ§in)";

        try {
            // Poco X7 Pro iÃ§in BLE GÃ¼Ã§lendirilmiÅŸ Tarama
            const device = await navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['generic_access', 0x1802, 0x1803]
            });

            s.style.background = "#059669";
            s.innerText = "YAYINLANDI: " + (device.name || "BLE Cihaz");
            
            if (navigator.vibrate) navigator.vibrate(200);

            setTimeout(() => { if(isAuto) loop(); }, 2000);
        } catch (e) {
            if(isAuto) setTimeout(() => loop(), 1000);
        }
    }
</script>
</body>
</html>
