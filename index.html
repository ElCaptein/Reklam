<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro-Markette BLE Paneli</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --p: #2563eb; --a: #7c3aed; --bg: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: #f8fafc; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; color: #1e293b; }
        
        /* Y√∂netim Paneli */
        .admin-box { background: #fff; width: 100%; max-width: 600px; padding: 25px; border-bottom: 3px solid var(--p); box-sizing: border-box; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .input-group { background: #f1f5f9; padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #64748b; margin-bottom: 5px; text-transform: uppercase; }
        input, textarea { width: 100%; border: 1px solid #cbd5e1; border-radius: 10px; padding: 12px; margin-bottom: 10px; box-sizing: border-box; font-size: 14px; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { border: none; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; color: white; }
        .btn-scan { background: linear-gradient(135deg, var(--p), var(--a)); grid-column: span 2; font-size: 16px; }
        .btn-update { background: #0f172a; }
        .btn-print { background: #475569; }
        .btn:active { transform: scale(0.96); opacity: 0.9; }

        /* QR ve Reklam Alanƒ± (B√ºy√ºk Boyut) */
        .display-card { background: white; width: 100%; max-width: 600px; padding: 40px 20px; text-align: center; box-sizing: border-box; border-radius: 0 0 30px 30px; }
        #qrcode { margin: 25px auto; padding: 15px; border: 1px solid #eee; display: inline-block; background: white; }
        
        .status-bar { display: none; margin: 10px 0; padding: 10px; border-radius: 10px; font-size: 13px; font-weight: 600; }
        
        .live-promo { margin-top: 30px; padding: 25px; border: 3px dashed var(--p); border-radius: 20px; background: #f0f7ff; display: none; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .display-card { padding: 0; margin: 0; }
            #qrcode img { width: 450px !important; height: 450px !important; }
        }
    </style>
</head>
<body>

    <div class="admin-box no-print">
        <h2 style="margin:0 0 20px 0; text-align:center;">üì° Reklam ve Tarama Kontrol√º</h2>
        
        <div class="input-group">
            <label>Kampanya Ba≈ülƒ±ƒüƒ± (QR'a G√∂m√ºl√ºr)</label>
            <input type="text" id="tInp" value="√ñzel M√º≈üteri ƒ∞ndirimi!" oninput="updateQR()">
            
            <label>Reklam Mesajƒ± (QR'a G√∂m√ºl√ºr)</label>
            <textarea id="mInp" rows="2" oninput="updateQR()">Bu karekodu okutan ≈üanslƒ± ki≈üiye kasada %25 anƒ±nda indirim! Kod: BLE2026</textarea>
        </div>

        <div class="btn-group">
            <button class="btn btn-scan" onclick="powerScan()">G√ú√áLENDƒ∞Rƒ∞LMƒ∞≈û BLE TARAMA BA≈ûLAT</button>
            <button class="btn btn-update" onclick="updateQR()">QR G√úNCELLE</button>
            <button class="btn btn-print" onclick="window.print()">QR √áIKTI AL (TAM SAYFA)</button>
        </div>
        
        <div id="status" class="status-bar"></div>
    </div>

    <div class="display-card">
        <h1 id="displayTitle" style="font-size: 2.2rem; margin:0; color: var(--p);">√ñzel M√º≈üteri ƒ∞ndirimi!</h1>
        <p style="color: #64748b; margin-top:10px; font-size: 1.1rem;">Kuponunuzu almak i√ßin QR kodu taratƒ±n</p>
        
        <div id="qrcode"></div>
        
        <div id="livePromo" class="live-promo">
            <h2 id="resT" style="margin:0; color: var(--a);"></h2>
            <p id="resM" style="font-size: 1.2rem; margin:15px 0; font-weight: 500;"></p>
            <div style="font-size: 12px; color: #94a3b8; border-top: 1px solid #e2e8f0; pt:10px;">
                Cihaz Sinyali: <b id="resD"></b> | Mod: <span style="color:var(--p)">Ultra-BLE</span>
            </div>
        </div>
    </div>

<script>
    let qrcode;

    // QR Kodu Ba≈ülat ve G√ºncelle
    function updateQR() {
        const t = document.getElementById('tInp').value;
        const m = document.getElementById('mInp').value;
        document.getElementById('displayTitle').textContent = t;
        
        // QR i√ßeriƒüine hem URL'yi hem de reklam metnini g√∂m√ºyoruz
        // B√∂ylece internet olmasa bile QR okuyucu mesajƒ± g√∂rebilir
        const qrContent = `KAMPANYA: ${t}\nMESAJ: ${m}\nLƒ∞NK: ${window.location.href}`;
        
        const qrDiv = document.getElementById("qrcode");
        qrDiv.innerHTML = ""; // Eski QR'ƒ± temizle
        
        qrcode = new QRCode(qrDiv, {
            text: qrContent,
            width: 350,
            height: 350,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });
    }

    window.onload = updateQR;

    // G√º√ßlendirilmi≈ü BLE ve Klasik Tarama
    async function powerScan() {
        const s = document.getElementById('status');
        const promo = document.getElementById('livePromo');
        
        s.style.display = "block";
        s.style.background = "#f1f5f9";
        s.textContent = "üîç Ultra-BLE Tarama Modu Aktif... Cihaz Bekleniyor.";

        try {
            // G√º√ßlendirilmi≈ü Filtreleme: Hem isim hem de servis bazlƒ± en geni≈ü arama
            const device = await navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: [
                    'generic_access', 
                    'device_information', 
                    'battery_service',
                    0x1802, // Immediate Alert (BLE cihazlar i√ßin)
                    0x1803  // Link Loss
                ]
            });

            s.style.background = "#dcfce7";
            s.style.color = "#166534";
            s.textContent = "‚úÖ Cihaz Yakalandƒ±!";

            // ƒ∞sim sorgusunu g√º√ßlendir
            let deviceName = device.name;
            if (!deviceName) {
                deviceName = "M√º≈üteri Cihazƒ± (Sinyal ID: " + device.id.slice(-6).toUpperCase() + ")";
            }

            document.getElementById('resT').textContent = document.getElementById('tInp').value;
            document.getElementById('resM').textContent = document.getElementById('mInp').value;
            document.getElementById('resD').textContent = deviceName;
            
            promo.style.display = "block";
            if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);

        } catch (err) {
            s.style.background = "#fee2e2";
            s.style.color = "#991b1b";
            s.textContent = "Tarama Durdu: " + err.message;
        }
    }
</script>

</body>
</html>
