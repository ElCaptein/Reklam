<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLE Reklam Ä°stasyonu - KararlÄ± SÃ¼rÃ¼m</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --p: #2563eb; --s: #059669; --bg: #f1f5f9; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: white; width: 100%; max-width: 500px; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #ddd; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; margin-bottom: 10px; font-size: 14px; }
        .btn-qr { background: #1e293b; }
        .btn-auto { background: var(--p); }
        .btn-stop { background: #dc2626; display: none; }
        #status { display: none; padding: 12px; text-align: center; border-radius: 8px; font-weight: bold; margin-bottom: 10px; }
        
        /* YazdÄ±rma AlanÄ± - A4 DÃ¼zeni */
        #printArea { display: none; flex-direction: column; gap: 40px; padding: 20px; align-items: center; }
        .qr-item { border: 3px solid #000; padding: 30px; border-radius: 20px; text-align: center; width: 380px; background: white; page-break-inside: avoid; }
        .q-title { font-size: 24px; margin: 0 0 10px 0; color: #000; text-transform: uppercase; }
        .q-msg { font-size: 16px; margin: 0 0 20px 0; color: #333; line-height: 1.4; }
        
        @media print {
            .no-print { display: none !important; }
            #printArea { display: flex !important; }
            body { background: white; }
        }
    </style>
</head>
<body>

    <div class="admin-panel no-print">
        <h2 style="text-align:center; color: var(--p);">ðŸ“¡ Bluetooth Reklam Paneli</h2>
        <div class="input-group">
            <label style="font-size: 11px; font-weight: bold; color: #666;">REKLAM BAÅžLIÄžI</label>
            <input type="text" id="tInp" value="Ã–ZEL Ä°NDÄ°RÄ°M FIRSATI">
            
            <label style="font-size: 11px; font-weight: bold; color: #666;">REKLAM MESAJI</label>
            <textarea id="mInp" rows="2">Bu QR kodu okutanlara kasada anÄ±nda %20 indirim uygulanacaktÄ±r!</textarea>
            
            <label style="font-size: 11px; font-weight: bold; color: #666;">YÃ–NLENDÄ°RÄ°LECEK LÄ°NK</label>
            <input type="text" id="urlInp" placeholder="BoÅŸ bÄ±rakÄ±lÄ±rsa bu sayfa aÃ§Ä±lÄ±r">
        </div>

        <button class="btn btn-qr" onclick="createQR()">1. QR KODLARI OLUÅžTUR</button>
        <button id="startBtn" class="btn btn-auto" onclick="startAutoMode()">2. OTOMATÄ°K SERÄ° YAYIN BAÅžLAT</button>
        <button id="stopBtn" class="btn btn-stop" onclick="stopAutoMode()">YAYINI DURDUR</button>
        <button class="btn btn-qr" style="background:#475569;" onclick="window.print()">3. A4 KAÄžIDA YAZDIR</button>
        
        <div id="status"></div>
    </div>

    <div id="printArea">
        <div class="qr-item">
            <h1 class="q-title"></h1>
            <p class="q-msg"></p>
            <div id="q1"></div>
            <p style="margin-top:15px; font-size:12px; font-weight:bold;">KameranÄ±zÄ± Okutun</p>
        </div>
        <div class="qr-item">
            <h1 class="q-title"></h1>
            <p class="q-msg"></p>
            <div id="q2"></div>
            <p style="margin-top:15px; font-size:12px; font-weight:bold;">KameranÄ±zÄ± Okutun</p>
        </div>
    </div>

<script>
    let isAuto = false;

    function createQR() {
        try {
            const title = document.getElementById('tInp').value;
            const msg = document.getElementById('mInp').value;
            const web = document.getElementById('urlInp').value || window.location.href;

            // YazÄ±larÄ± A4 kaÄŸÄ±dÄ±na basÄ±lacak yerlere aktar
            document.querySelectorAll('.q-title').forEach(el => el.innerText = title);
            document.querySelectorAll('.q-msg').forEach(el => el.innerText = msg);

            // Overflow hatasÄ±nÄ± Ã¶nlemek iÃ§in QR iÃ§ine SADECE link koyuyoruz
            ["q1", "q2"].forEach(id => {
                const el = document.getElementById(id);
                el.innerHTML = "";
                new QRCode(el, {
                    text: web, // Sadece URL
                    width: 250,
                    height: 250,
                    correctLevel: QRCode.CorrectLevel.M // Orta seviye hata dÃ¼zeltme (daha stabil)
                });
            });

            document.getElementById('printArea').style.display = "flex";
            alert("QR Kodlar BaÅŸarÄ±yla OluÅŸturuldu!");
        } catch (e) {
            alert("QR HatasÄ±: " + e.message + "\nLÃ¼tfen linki kontrol edin.");
        }
    }

    async function startAutoMode() {
        isAuto = true;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'block';
        loop();
    }

    function stopAutoMode() {
        isAuto = false;
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('status').style.display = 'none';
    }

    async function loop() {
        if (!isAuto) return;
        const s = document.getElementById('status');
        s.style.display = "block";
        s.style.background = "#2563eb";
        s.style.color = "white";
        s.innerText = "Yeni Cihaz TaranÄ±yor... Listeden seÃ§in.";

        try {
            const device = await navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['generic_access', 0x1802, 0x180a]
            });

            s.style.background = "#059669";
            s.innerText = "YayÄ±n BaÅŸarÄ±lÄ±: " + (device.name || "MÃ¼ÅŸteri CihazÄ±");
            
            if (navigator.vibrate) navigator.vibrate(200);
            setTimeout(() => { if(isAuto) loop(); }, 2500);
        } catch (e) {
            if(isAuto) setTimeout(() => loop(), 1000);
        }
    }
</script>
</body>
</html>
