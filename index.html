<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°ÅŸletme BLE Reklam Paneli</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --primary: #2563eb; --accent: #7c3aed; --bg: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* Panel AlanÄ± */
        .admin-panel { background: white; width: 100%; max-width: 500px; padding: 20px; border-bottom: 2px solid #e2e8f0; box-sizing: border-box; }
        .input-group { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e2e8f0; }
        input, textarea { width: 100%; border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; margin-top: 5px; box-sizing: border-box; }
        
        .btn { width: 100%; color: white; border: none; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; margin-bottom: 10px; }
        .btn-ble { background: linear-gradient(135deg, var(--primary), var(--accent)); }

        /* QR Kod - Tam Sayfa OdaklÄ± */
        .qr-card { background: white; width: 100%; max-width: 500px; padding: 40px 20px; text-align: center; box-sizing: border-box; min-height: 70vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #qrcode { margin: 20px auto; padding: 20px; border: 10px solid #f1f5f9; border-radius: 20px; }
        #qrcode img { width: 300px !important; height: 300px !important; } /* QR boyutu bÃ¼yÃ¼tÃ¼ldÃ¼ */

        .status-badge { display: none; padding: 10px; border-radius: 30px; font-size: 12px; font-weight: bold; margin-bottom: 10px; }

        @media print {
            .no-print { display: none !important; }
            .qr-card { min-height: 100vh; padding: 0; }
            #qrcode { border: none; }
        }
    </style>
</head>
<body>

    <div class="admin-panel no-print">
        <h3 style="margin-top:0;">ðŸ“¡ BLE Reklam KontrolÃ¼</h3>
        <div class="input-group">
            <label style="font-size:12px; font-weight:bold; color:#64748b;">KAMPANYA METNÄ°</label>
            <input type="text" id="tInp" value="HOÅž GELDÄ°NÄ°Z!">
            <textarea id="mInp" rows="2">Size Ã¶zel indirim tanÄ±mlandÄ±. Bluetooth ile doÄŸrulayÄ±n!</textarea>
        </div>
        <button class="btn btn-ble" onclick="startBLERadiation()">BLE TARAMASI VE YAYIN BAÅžLAT</button>
        <div id="status" class="status-badge"></div>
    </div>

    <div class="qr-card">
        <h1 style="font-size: 2rem; margin: 0; color: #1e293b;">Ä°NDÄ°RÄ°MÄ° YAKALA</h1>
        <p style="color: #64748b; font-size: 1.1rem; margin-top: 10px;">Telefonunuzun kamerasÄ±nÄ± buraya tutun</p>
        
        <div id="qrcode"></div>
        
        <div id="reklamSonuc" style="display:none; border-top: 2px solid #eee; pt:20px; width:100%;">
            <h2 id="resT" style="color:var(--primary); margin-bottom:5px;"></h2>
            <p id="resM" style="font-size: 1.2rem; margin:0;"></p>
            <small style="color:#94a3b8;">Cihaz DoÄŸrulandÄ±: <b id="resD"></b></small>
        </div>
    </div>

<script>
    // QR Kodu BÃ¼yÃ¼k Ã–lÃ§ekte OluÅŸtur
    window.onload = function() {
        new QRCode(document.getElementById("qrcode"), {
            text: window.location.href,
            width: 300,
            height: 300,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });
    };

    // BLE MantÄ±ÄŸÄ±
    async function startBLERadiation() {
        const s = document.getElementById('status');
        const rBox = document.getElementById('reklamSonuc');
        
        try {
            s.style.display = "inline-block";
            s.style.background = "#e2e8f0";
            s.textContent = "BLE Sinyalleri Ä°zleniyor...";

            // BLE Tarama ve EtkileÅŸim
            // Not: TarayÄ±cÄ± Ã¼zerinden "Broadcast" (YayÄ±n) yapmak gÃ¼venlik nedeniyle kÄ±sÄ±tlÄ±dÄ±r.
            // Bu fonksiyon Ã§evredeki BLE sinyallerini yakalayÄ±p "El SÄ±kÄ±ÅŸma" (Handshake) taklidi yapar.
            const device = await navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['generic_access', 'device_information']
            });

            s.style.background = "#dcfce7";
            s.style.color = "#166534";
            s.textContent = "BLE BaÄŸlantÄ±sÄ± Aktif!";

            document.getElementById('resT').textContent = document.getElementById('tInp').value;
            document.getElementById('resM').textContent = document.getElementById('mInp').value;
            document.getElementById('resD').textContent = device.name || "Bilinmeyen BLE Cihaz";
            
            rBox.style.display = "block";
            if (navigator.vibrate) navigator.vibrate([100, 200, 100]);

        } catch (err) {
            s.style.display = "inline-block";
            s.style.background = "#fee2e2";
            s.textContent = "Hata: " + err.message;
        }
    }
</script>

</body>
</html>
